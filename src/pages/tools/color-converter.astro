---
import ToolLayout from '../../layouts/ToolLayout.astro';
---

<ToolLayout title="Color Converter" description="Convert between HEX, RGB, and HSL color formats with live preview." toolName="Color Converter">
  <div style="display: flex; gap: 1.5rem; flex-wrap: wrap; align-items: flex-start;">
    <!-- Color picker + preview -->
    <div style="text-align: center;">
      <div id="swatch" style="width: 120px; height: 120px; border-radius: var(--radius-lg); border: 2px solid var(--color-border); background: #2563eb; margin-bottom: 0.75rem;"></div>
      <input type="color" id="picker" value="#2563eb" style="width: 120px; height: 36px; cursor: pointer; border: none; border-radius: var(--radius-md);" />
    </div>

    <!-- Inputs -->
    <div style="flex: 1; min-width: 250px; display: flex; flex-direction: column; gap: 1rem;">
      <div>
        <span class="tool-panel__label">HEX</span>
        <input id="hex" class="tool-input" value="#2563eb" placeholder="#2563eb" />
      </div>
      <div>
        <span class="tool-panel__label">RGB</span>
        <div style="display: flex; gap: 0.5rem;">
          <input id="r" class="tool-input" type="number" min="0" max="255" value="37" placeholder="R" style="width: 33%;" />
          <input id="g" class="tool-input" type="number" min="0" max="255" value="99" placeholder="G" style="width: 33%;" />
          <input id="b" class="tool-input" type="number" min="0" max="255" value="235" placeholder="B" style="width: 33%;" />
        </div>
      </div>
      <div>
        <span class="tool-panel__label">HSL</span>
        <div style="display: flex; gap: 0.5rem;">
          <input id="h" class="tool-input" type="number" min="0" max="360" value="221" placeholder="H" style="width: 33%;" />
          <input id="s" class="tool-input" type="number" min="0" max="100" value="83" placeholder="S%" style="width: 33%;" />
          <input id="l" class="tool-input" type="number" min="0" max="100" value="53" placeholder="L%" style="width: 33%;" />
        </div>
      </div>
      <div>
        <span class="tool-panel__label">CSS Values</span>
        <div id="css-values" style="font-family: var(--font-mono); font-size: 0.8rem; background: var(--color-surface); border: 1px solid var(--color-border); border-radius: var(--radius-md); padding: 0.75rem; line-height: 1.8;"></div>
      </div>
    </div>
  </div>
</ToolLayout>

<script is:inline>
  var hexEl = document.getElementById('hex');
  var rEl = document.getElementById('r'), gEl = document.getElementById('g'), bEl = document.getElementById('b');
  var hEl = document.getElementById('h'), sEl = document.getElementById('s'), lEl = document.getElementById('l');
  var swatch = document.getElementById('swatch');
  var picker = document.getElementById('picker');
  var cssVal = document.getElementById('css-values');

  function hexToRgb(hex) {
    hex = hex.replace('#', '');
    if (hex.length === 3) hex = hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2];
    return { r: parseInt(hex.substr(0,2),16), g: parseInt(hex.substr(2,2),16), b: parseInt(hex.substr(4,2),16) };
  }
  function rgbToHex(r,g,b) {
    return '#' + [r,g,b].map(function(x) { return x.toString(16).padStart(2,'0'); }).join('');
  }
  function rgbToHsl(r,g,b) {
    r/=255; g/=255; b/=255;
    var max=Math.max(r,g,b), min=Math.min(r,g,b), h, s, l=(max+min)/2;
    if (max===min) { h=s=0; }
    else {
      var d=max-min; s=l>0.5?d/(2-max-min):d/(max+min);
      if (max===r) h=((g-b)/d+(g<b?6:0))/6;
      else if (max===g) h=((b-r)/d+2)/6;
      else h=((r-g)/d+4)/6;
    }
    return { h: Math.round(h*360), s: Math.round(s*100), l: Math.round(l*100) };
  }
  function hslToRgb(h,s,l) {
    h/=360; s/=100; l/=100;
    var r,g,b;
    if (s===0) { r=g=b=l; }
    else {
      function hue2rgb(p,q,t) { if(t<0)t+=1; if(t>1)t-=1; if(t<1/6)return p+(q-p)*6*t; if(t<1/2)return q; if(t<2/3)return p+(q-p)*(2/3-t)*6; return p; }
      var q=l<0.5?l*(1+s):l+s-l*s, p=2*l-q;
      r=hue2rgb(p,q,h+1/3); g=hue2rgb(p,q,h); b=hue2rgb(p,q,h-1/3);
    }
    return { r: Math.round(r*255), g: Math.round(g*255), b: Math.round(b*255) };
  }

  function updateAll(r,g,b, source) {
    var hex = rgbToHex(r,g,b);
    var hsl = rgbToHsl(r,g,b);
    if (source !== 'hex') hexEl.value = hex;
    if (source !== 'rgb') { rEl.value = r; gEl.value = g; bEl.value = b; }
    if (source !== 'hsl') { hEl.value = hsl.h; sEl.value = hsl.s; lEl.value = hsl.l; }
    swatch.style.background = hex;
    picker.value = hex;
    cssVal.innerHTML = '<div>' + hex + '</div><div>rgb(' + r + ', ' + g + ', ' + b + ')</div><div>hsl(' + hsl.h + ', ' + hsl.s + '%, ' + hsl.l + '%)</div>';
  }

  hexEl.addEventListener('input', function() {
    try { var rgb = hexToRgb(hexEl.value); updateAll(rgb.r, rgb.g, rgb.b, 'hex'); } catch(e) {}
  });
  [rEl, gEl, bEl].forEach(function(el) {
    el.addEventListener('input', function() { updateAll(+rEl.value, +gEl.value, +bEl.value, 'rgb'); });
  });
  [hEl, sEl, lEl].forEach(function(el) {
    el.addEventListener('input', function() { var rgb = hslToRgb(+hEl.value, +sEl.value, +lEl.value); updateAll(rgb.r, rgb.g, rgb.b, 'hsl'); });
  });
  picker.addEventListener('input', function() { hexEl.value = picker.value; var rgb = hexToRgb(picker.value); updateAll(rgb.r, rgb.g, rgb.b, 'hex'); });

  updateAll(37, 99, 235, '');
</script>
